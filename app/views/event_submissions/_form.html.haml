= form_for [@event, @event_submission] do |f|
  - if @event_submission.errors.any?
    #error_explanation
      %h2= "#{pluralize(@event_submission.errors.count, "error")} prohibited this Submission from being saved:"
      %ul
        - @event_submission.errors.full_messages.each do |msg|
          %li= msg
        - @event_submission.form_answers.each do |a|
          - a.errors.full_messages.each do |msg|
            %li= msg
  .field
    = f.hidden_field :account_id, value: current_account.id
  .field
    = f.hidden_field :event_id, value: @event.id

  #form_answers
    = f.fields_for(:form_answers) do |ff|
      = render 'form_answer_fields', f: ff

  %h2 Rewards
  #selected_rewards
    = collection_check_boxes(:event_submission, :selected_rewards, @event.event_rewards, :id, :name) do |b|
      = b.label(class: 'check_box') { "#{b.check_box} #{b.text}" }
  %div
    .col-md-2
      %h3 Total
    .col-md-10
      #rewards_total
        0.0
  %br
  -# https://github.com/railscasts/288-billing-with-stripe
  -# https://stripe.com/docs/api/ruby#create_card_token
  -# https://support.stripe.com/questions/can-i-save-a-card-and-charge-it-later
  #payment_cards
    = f.fields_for(:payment_card) do |ff|
      = render 'payment_card_fields', f: ff

  %br
  .actions
    = f.submit 'Save'

:javascript
  $('.select2').select2();

  $('input:checkbox').on('change', function(){
    var payload = $('input:checkbox:checked').serialize()
    console.log(payload)
    $.ajax({
      type: "POST",
      url: "/event_rewards_calculate",
      data: $('input:checkbox:checked').serialize(),
      dataType: "html",
      success: function(data) {
        console.log(data)
        $('#rewards_total').html(data)
      },
      error: function(){
        alert('error handing here');
      }
    });
  });
